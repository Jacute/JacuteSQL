# JacuteSQL

Простейшая СУБД с неполноценной поддержкой синтаксиса SQL.

## Особенности

- Поддержка команд SELECT, INSERT, DELETE.
- Для команд SELECT и DELETE реализован условный оператор WHERE.
- CREATE TABLE не реализован, вместо него файл schema.json, с помощью которого создаётся база данных при запуске программы.
- В проекте используется [самописный хэндлер](https://github.com/jacute/prettylogger) для пакета log/slog.
- СУБД запускается в docker контейнере.
- Все данные хранятся в storage/<название_бд>/<название_таблицы>/<номер_листа>.csv. При достижении ограничения tuples_limit создаётся новый лист. SELECT считывает данные из БД постранично.
- Для обработки данных из БД используются самописные структуры.

## Запуск

```bash
docker compose up --build -d
```

## Примеры команд
- `INSERT INTO table1 VALUES ('val1', 'val2', 'val3');`
- `SELECT table1.col1, table1.col2 FROM table1;`
- `SELECT table1.col1, table2.col2 FROM table1, table2;`
- `SELECT table1.col1 FROM table1 WHERE table1.col2 = 'val';`
- `DELETE FROM table1, table2;`
- `DELETE FROM table1 WHERE table1.col1 = 'val';`

## Структура проекта

- `cmd/`: Основные исполняемые файлы приложения.
  - `JacuteSQL/main.go`: Точка входа в СУБД.

- `config/config.yaml`: Конфигурационные файл приложения.

- `internal/`: Внутренние пакеты приложения.
  - `app/app.go`: Запуск приложения, обработка входящих подключений.
  - `config/`: Загрузка и управление конфигурацией.
  - `data_structures/`: Самописные структуры данных.
  - `lib/`: Вспомогательные пакеты.
  - `logger/`: Настройка логгера.
  - `storage/`: Основной функционал программы.
    - `condition.go`: Функции для обработки условия WHERE.
    - `lock.go`: Блокировки таблиц в базе данных.
    - `maker.go`: Создание структуры базы данных.
    - `storage.go`: Обработка основных команд.

- `tests/`: Тесты приложения (недописаны).

## Структура БД
Пример структуры:
- `database`
  - `table1`
    - `1.csv`
    - `table1_pk_sequence`
    - `table1_lock`
  - `table2`
    - `1.csv`
    - `table2_pk_sequence`
    - `table2_lock`

Есть корневая директория БД, в которой хранятся таблицы.

В каждой таблице хранятся листы <номер_листа>.csv.

<название_таблицы>_pk_sequence для хранения последнего идентификатора строки.

<название_таблицы>_lock для блокировки таблицы.

## Конфигурация

Конфигурация базы данных находится в файле `schema.json`.

- `name`: Название базы данных.
- `tuples_limit`: Ограничение на количество строк в листе. 
- `structure`: Структура базы данных. Ключ - название таблицы, значение - колонки в таблице. У каждой таблицы по умолчанию есть дополнительная колонка <название_таблицы>_pk

Конфигурация приложения находится в файле `config/config.yaml`.
- `env`: Тип окружения. Влияет на логгер. local - логи пишутся в консоль, prod - логи пишутся в файл.
- `storage_path`: Путь до директории с базами данных.
- `schema_path`: Путь до конфига базы данных.
- `log_path`: Путь до лог файла. При env: "local" этот пункт игнорируется.
- `port`: Порт СУБД.
- `connTL`: Время на поддержание соединения между клиентом и сервером, при равном 0 ограничения нет.
